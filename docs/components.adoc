= Parts and layouts
:toc: right
:imagesdir: media/
:sourcedir: ../src

With custom page rendering setup, we are ready to add more components to the page.

== Parts

Enonic also provides customizable components - aka link:https://developer.enonic.com/docs/xp/stable/cms/components#part[parts].Just like for page components, parts must be defined in both Enonic and Next.

=== Task: Child list and heading components

We'll start off by adding a component that lists child items in the tree structure.

. **Add the `child-list` part** to the Enonic app
+
.src/main/resources/site/parts/child-list/child-list.xml
[source,xml]
----
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<part xmlns="urn:enonic:xp:model:1.0">
  <display-name>Children</display-name>
  <description>Lists child items</description>
</part>
----
+
To work seamlessly with Content Studio's WYSIWYG page editor, parts need a controller file that can reload changes to the component, without refreshing the entire page.
+
. **Add the preview controller file** for the child-list part
+
.src/main/resources/site/parts/child-list/child-list.js
[source,JavaScript]
----
var proxy = require('/lib/frontend-proxy/proxy');

exports.get = proxy.get;
----
+
. **Add the `heading` part files** to the Enonic app
+
This part definition includes a form, with an link:https://developer.enonic.com/docs/xp/stable/cms/input-types[input field] called `heading`. This makes it possible for editors to override the heading (aka displayName) coming from the content item.
+
.src/main/resources/site/parts/heading/heading.xml
[source,xml]
----
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<part xmlns="urn:enonic:xp:model:1.0">
    <display-name>Heading</display-name>
    <description>Demo heading</description>
    <form>
        <input type="TextLine" name="heading">
            <label>Override heading</label>
        </input>
    </form>
</part>
----
+
.src/main/resources/site/parts/heading/heading.js
[source,JavaScript]
----
var proxy = require('/lib/frontend-proxy/proxy');

exports.get = proxy.get;
----
+
. **Build and deploy your Enonic app** once more to make the new part accessible to from Content Studio.
+
. **Add parts to the page**
+
NOTE: Before moving on, if you added a Text component, delete it from the region (`right-click -> Delete` on the component).
+
After re-deploying the app, head over to Content Studio, and edit the Movies page again. Drop the "Children" part into the region (`right-click -> Insert`, or drag-n-drop from the Insert panel on the right).
+
TIP: This actually works already, because the CMS adapter contains fallback part rendering when working in DEV mode.
+
image:cs-part-default.png[title="Next.js-rendered text component with an image",width=700px]
+
TIP: As usual, you can navigate to http://localhost:3000/movies to verify it directly from Next.js.

=== Task: Next.js part rendering

Moving over to the Next.js, we need to support rendring of the new components.

. **Add the part handlers to the Next app**
+
.src/cms/parts/Heading.jsx
[source,JavaScript]
----
import React from "react"
import {APP_NAME} from "../../enonicAdapter/enonic-connection-config";

// fully qualified XP part name:
export const HEADING_PART_NAME = `${APP_NAME}:heading`;

const HeadingView = ({part, content}) => (
    <h2>{part?.config?.heading || content.displayName}</h2>
);

export default HeadingView;
----
+
.src/cms/parts/ChildList.jsx
[source,JavaScript]
----
import React from "react"
import {
    APP_NAME,
    getContentLinkUrlFromXpPath
} from "../../enonicAdapter/enonic-connection-config";

// fully qualified XP part name:
export const CHILDLIST_PART_NAME = `${APP_NAME}:child-list`;

const ChildListView = ({content}) => {
    const {children} = content;

    return children && (
        <ul>{
            children.map((child, i) => (
                <li key={i}>
                    <a href={getContentLinkUrlFromXpPath(child._path)}>
                        {child.displayName}
                    </a>
                </li>
            ))
        }</ul>
    );
};

export default ChildListView;
----
+
. Finally, let's **register the components**:
+
Update the typeRegistration file a with the following changes:
+
.src/cms/typesRegistration.ts
[source,javascript,options="nowrap"]
----
// (...other imports...)

import HeadingView, {HEADING_PART_NAME} from "./parts/Heading";
import ChildListView, {CHILDLIST_PART_NAME} from './parts/ChildList';

// (...other type registrations...)

TypesRegistry.addPart(CHILDLIST_PART_NAME, {
    view: ChildListView,
})
TypesRegistry.addPart(HEADING_PART_NAME, {
    view: HeadingView,
})
----
Next.js will now use the new views and queries to render the parts. Try overriding the heading, and see what happens.
+
image:cs-part-nextjsviewed.png[title="Next.js-rendered text component with an image",width=700px]


== Layouts

TODO:



That completes the introduction to parts and layouts, in the next chapter we will look into reusing pages and components.
