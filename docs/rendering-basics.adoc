= Rendering basics
:toc: right
:imagesdir: media/
:sourcedir: ../src

In this chapter we will look into the basic rendering mechanisms, and add some custom rendering to our app as well.

== Dev mode fallback rendering

As you have seen during the setup of Next, each content item automatically render a page, listing available props. These props are automatically fetched by the Enonic Adapter.

By defining custom queries and react components tailored for each content type, we can customise the props passed to the view, and which view is actually being used.

== Task: Get person content

With that sorted out, let's get customizing - starting with content of the type "person":

NOTE: The full name of your content type should now be "com.example.myproject:person" If you used a different name when creating the Enonic app, update the `.env` in your Next app to reflect this.

. **Add query** by creating the following file in your Next application
+
.src/components/queries/getPerson.ts
[source,TypeScript]
----
include::{sourcedir}/components/queries/getPerson.ts[]
----
+
This file defines a graphQL query 'getPerson' that will fetch data from the Enonic API. 
+
TIP: You may validate the query by copying it to the GraphQL playground. Replace `APP_NAME_UNDERSCORED` with `com_example_myproject` and set a query variable, try this for instance:
  `{"path": "/hmdb/persons/brad-pitt"}``
+
. **Register the query** by adding the following lines to the component mappings file:
+
.src/components/_mappings.ts
[source,JavaScript]
----
import getPerson from './queries/getPerson';

....

TypesRegistry.addContentType(`${APP_NAME}:person`, {
    query: getPerson,
});
----
+
. **View the result**
+
By visiting a person item - for instance `http://localhost:3000/persons/brad-pitt` you should now see a different set of props being listed by the default view.
+
image:missing image[title="Development view showing person data from query",width=650px]
+
.

== Task: Add custom person rendering

With fresh content available, it's time to make things shine:

. **Add view** by creating the following file in your Next application
+
.src/components/views/Person.tsx
[source,TypeScript]
----
include::{sourcedir}/components/views/Person.tsx[]
----
+
This file defines a react view 'Person' that will use the props from the query to render the person. 
+
. **Register Person view** in the mapping by adding the following lines to the component mappings:
+
.src/components/_mappings.ts
[source,JavaScript]
----
import Person from './views/Person';

....

TypesRegistry.addContentType(`${APP_NAME}:person`, {
    view: Person,
});
----
+
. **View the result** - The page should automatically reload once the change has been saved
+
image:morgan-freeman-plain.png[title="Person rendering with query and view",width=1069px]

The content type mapping applies to every `person` content item in the site, regardless of it's location in the hierarchy. Try looking at some other persons, eg. http://localhost:3000/persons/uma-thurman


== Task: Add custom header and footer

Adding some styles, a header and a footer will make the site more interesting visually. Next provides a handy solution to this problem.

The `_app.tsx` file initializes the React pipeline, and by modifying it we can inject the same header and footer components to all pages generated by Next. 

Sample header and footer views are already included in the starter under /`src/components/views`, so all we need to do is put them to work.

Update `src/pages/_app.tsx`` with the following changes:

. **Add these imports**
+
[source,TypeScript]
----
import Header from "../components/views/Header";
import Footer from "../components/views/Footer";
import {getUrl} from "../_enonicAdapter/utils";
----
+
. And **replace this line**:
+
[source,TypeScript]
----
return <Component {...pageProps} />;
----
+
with this:
+
[source,TypeScript]
----
return (          
<>
  <Header 
    title="Enonic <3 Next.js" 
    logoUrl={getUrl('images/xp-shield.svg')}/>
    <main style={{
      margin: `0 auto`,
      maxWidth: 960,
      padding: `0 1rem`,
      }}>
      <Component {...pageProps} />
    </main>
  <Footer/>
</>
);
----

Morgan Freeman's page should now look like this

image:morgan-freeman-header-footer.png[title="Rendering with header and footer",width=1068px]

With the basic rendering done, in the next chapter, well add <<preview#, Content Studio preview>> into the mix.


